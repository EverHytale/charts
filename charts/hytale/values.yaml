# Default values for hytale.
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

# -- Number of replicas (should be 1 for game servers)
replicaCount: 1

# -- Container image configuration
image:
  # -- Image repository
  repository: everhytale/hytale-server
  # -- Image pull policy
  pullPolicy: IfNotPresent
  # -- Overrides the image tag whose default is the chart appVersion
  tag: ""

# -- Image pull secrets for private registries
imagePullSecrets: []
# -- Override the chart name
nameOverride: ""
# -- Override the full name
fullnameOverride: ""

# -- Service account configuration
serviceAccount:
  # -- Specifies whether a service account should be created
  create: true
  # -- Automatically mount a ServiceAccount's API credentials
  automount: false
  # -- Annotations to add to the service account
  annotations: {}
  # -- The name of the service account to use
  name: ""

# -- Pod annotations
podAnnotations: {}
# -- Pod labels
podLabels: {}

# -- Pod security context
# UID/GID 1001 matches the Dockerfile (ARG HYTALE_UID/HYTALE_GID)
podSecurityContext:
  fsGroup: 1001

# -- Container security context
securityContext:
  runAsNonRoot: true
  runAsUser: 1001
  runAsGroup: 1001

# =============================================================================
# Console Access Configuration
# =============================================================================

console:
  # -- Enable TTY for the container (required for kubectl attach -it)
  tty: true
  # -- Enable stdin for the container (required for kubectl attach -it)
  stdin: true

# =============================================================================
# Hytale Server Configuration
# =============================================================================

server:
  # -- Server port (Hytale uses QUIC/UDP on port 5520)
  port: 5520
  # -- Server bind address
  bind: "0.0.0.0"

  # -- Authentication mode (authenticated, unauthenticated)
  authMode: "authenticated"

  # -- Disable Sentry error reporting (development mode)
  disableSentry: false

  # -- Enable AOT cache for faster startup (requires HytaleServer.aot)
  useAotCache: true

  # -- Extra arguments to pass to the server
  # Example: "--allow-op --accept-early-plugins"
  extraArgs: ""

# =============================================================================
# JVM Configuration
# =============================================================================

jvm:
  # -- Minimum memory allocation (minimum 4GB recommended by Hytale)
  minMemory: "4G"
  # -- Maximum memory allocation
  maxMemory: "8G"
  # -- Additional JVM options (overrides default JAVA_OPTS)
  # Default: -XX:+UseG1GC -XX:+ParallelRefProcEnabled -XX:+DisableExplicitGC
  #          -XX:+AlwaysPreTouch -XX:+UseStringDeduplication -XX:+OptimizeStringConcat
  #          -Dfile.encoding=UTF-8
  javaOpts: ""

# =============================================================================
# Backup Configuration
# =============================================================================

backup:
  # -- Enable automatic backups (--backup)
  enabled: false
  # -- Backup directory path (--backup-dir)
  dir: "/server/backups"
  # -- Backup frequency in minutes (--backup-frequency)
  frequency: 30
  # -- Maximum number of backups to keep (--backup-max-count)
  maxCount: 5

# =============================================================================
# Token Authentication (alternative to /auth login device)
# =============================================================================
# Tokens can be obtained via OAuth2 Device Flow using hytale-auth.sh
# If not provided, use '/auth login device' after server start

auth:
  # -- Owner username (for display purposes)
  ownerName: ""
  # -- Owner UUID
  ownerUuid: ""
  # -- Session token
  sessionToken: ""
  # -- Identity token
  identityToken: ""

  # -- Use existing secret for authentication tokens
  # Secret should contain keys: SESSION_TOKEN, IDENTITY_TOKEN, OWNER_NAME, OWNER_UUID
  existingSecret: ""

# =============================================================================
# Machine ID Configuration
# =============================================================================
# Required for encrypted authentication persistence
# If not mounted, authentication may need to use 'Memory' persistence

machineId:
  # -- Mount /etc/machine-id from host
  mountFromHost: false
  # -- Host path for machine-id (usually /etc/machine-id)
  hostPath: "/etc/machine-id"

# =============================================================================
# Service Configuration
# =============================================================================

service:
  # -- Service type (ClusterIP, NodePort, LoadBalancer)
  type: ClusterIP
  # -- Game port (QUIC/UDP)
  port: 5520
  # -- Node port (only if type is NodePort, range 30000-32767)
  nodePort: null
  # -- External traffic policy (Local or Cluster)
  # Use "Local" to preserve client IP for LoadBalancer/NodePort
  externalTrafficPolicy: ""
  # -- Service annotations
  annotations: {}

# =============================================================================
# Persistence Configuration
# =============================================================================

persistence:
  # -- Enable persistence for server data (universe, logs, config, auth.enc)
  enabled: true
  # -- Use an existing PVC
  existingClaim: ""
  # -- Storage class (use "-" for default)
  storageClass: ""
  # -- Access mode
  accessMode: ReadWriteOnce
  # -- Storage size
  size: 10Gi
  # -- PVC annotations
  annotations: {}

# =============================================================================
# Gateway API - UDPRoute Configuration
# =============================================================================

udpRoute:
  # -- Enable Gateway API UDPRoute (requires Gateway API v1alpha2+)
  enabled: false
  # -- UDPRoute annotations
  annotations: {}
  # -- Parent Gateway references
  parentRefs:
    - name: gateway
      sectionName: hytale
      # namespace: default

# =============================================================================
# Resource Configuration
# =============================================================================

resources:
  requests:
    cpu: 1000m
    memory: 4Gi
  limits:
    cpu: 4000m
    memory: 8Gi

# =============================================================================
# Probes Configuration
# =============================================================================

# -- Liveness probe configuration (checks if HytaleServer.jar process is running)
livenessProbe:
  exec:
    command:
      - pgrep
      - -f
      - HytaleServer.jar
  initialDelaySeconds: 120
  periodSeconds: 30
  timeoutSeconds: 10
  failureThreshold: 3

# -- Readiness probe configuration
readinessProbe:
  exec:
    command:
      - pgrep
      - -f
      - HytaleServer.jar
  initialDelaySeconds: 60
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 3

# -- Startup probe configuration (gives time for initial startup)
startupProbe:
  exec:
    command:
      - pgrep
      - -f
      - HytaleServer.jar
  initialDelaySeconds: 30
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 30

# =============================================================================
# Scheduling Configuration
# =============================================================================

# -- Additional volumes
volumes: []

# -- Additional volume mounts
volumeMounts: []

# -- Node selector
nodeSelector: {}

# -- Tolerations
tolerations: []

# -- Affinity rules
affinity: {}
